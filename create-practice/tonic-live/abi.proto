syntax="proto3";

package abi;

// data send to server for`用于 login
message LoginRequest{
  string username=1;
  string password=2;
}

// token generated by server`服务器生成的token
message Token{
  string data=1;
}

// data structure for seding a new message
message NewChatMessage{
  // unique room name
  // could by username like "zhengmr",模糊用户名
  // could by a group name "engineering"，组名称
  // or a comma separted list of usernames "zhengmr,zhou"，逗号分割的用户名
  string room=1;
  string conntent=2;
}

// empty send message response
message SendMessageResponse{
}

// empty get message request
message GetMessageRequest{

}

// chat message
message ChatMessage{
  // who send this message`谁发送的消息
  string sender=1;
  // room this message belongs to`消息所属的room
  string room=2;
  // message content`消息内容
  string content=3;
  // timestamp when this message is sent`消息什么时间(戳)发送的
  int64 timestamp=4;
}

service Chat{
  // Login user and get token
  rpc Login(LoginRequest) returns (Token){}
  // send meesgae to a room
  rpc SendMessage(NewChatMessage)returns(SendMessageResponse){}
  // subscribe and get all message`订阅并获取所有消息
  rpc GetMessage(GetMessageRequest)returns(stream ChatMessage){}
}
